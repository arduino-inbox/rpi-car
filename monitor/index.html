<!DOCTYPE html>
<html>
<head>
  <title>Car Monitor</title>
  <script type="text/javascript" src="smoothie.js"></script>
  <script type="text/javascript" src="/socket.io/socket.io.js"></script>
  <script type="text/javascript">
    var measurements = {};
    var current_state = {};
    var dataPoints = [
        //'test-gyro-0',
        //'test-gyro-1',
        //'test-gyro-2',
        'test-accel-0',
        'test-accel-1'
        //'test-accel-2'
    ];

    function init() {
      initChart();
      initWebsocket();
    }

    function getRandomInt(min, max) {
        return Math.floor(Math.random() * (max - min + 1)) + min;
    }

    function initChart() {
      var chart = new SmoothieChart();
      dataPoints.forEach(function (p) {
        measurements[p] = new TimeSeries();
        var c = getRandomInt(0, 255)+', '+getRandomInt(0, 255)+', '+getRandomInt(0, 255);
        chart.addTimeSeries(measurements[p], {
          strokeStyle: 'rgba('+c+', 1)',
          fillStyle: 'rgba('+c+', 0.2)',
          lineWidth: 2
        });
        current_state[p] = 0;
      });

      chart.streamTo(document.getElementById("measurement-chart"), 50);

      setInterval(autoUpdate, 2000);
    }

    function initWebsocket() {
      var socket = io.connect('http://localhost:8080');
      socket.on('measurements_update', function (data) {
        current_state[data['key']] = parseInt(data['value']);
        //console.log(current_state);
        updateChart();
      });
    }

    function updateChart() {
        dataPoints.forEach(function (p) {
            measurements[p].append(new Date().getTime(), current_state[p]);
        });
    }

    function autoUpdate() {
        //console.log(current_state);
        updateChart();
    }

  </script>
</head>
<body onload="init()" style="background-color: #000000; color: #ffffff">
<h1>Measurements</h1>
<canvas id="measurement-chart" width="600" height="200">
</canvas>
</body>
</html>